const express = require('express');

const app = express();


const wasmCode = new Uint8Array([
    0x00, 0x61, 0x73, 0x6d, 0x01, 0x00, 0x00, 0x00, 0x01, 0x17, 0x05, 0x60, 0x02, 0x7f, 0x7f, 0x01,
    0x7f, 0x60, 0x00, 0x01, 0x7f, 0x60, 0x00, 0x00, 0x60, 0x01, 0x7f, 0x00, 0x60, 0x01, 0x7f, 0x01,
    0x7f, 0x03, 0x09, 0x08, 0x02, 0x00, 0x00, 0x00, 0x01, 0x03, 0x04, 0x01, 0x04, 0x05, 0x01, 0x70,
    0x01, 0x02, 0x02, 0x05, 0x06, 0x01, 0x01, 0x80, 0x02, 0x80, 0x02, 0x06, 0x09, 0x01, 0x7f, 0x01,
    0x41, 0x90, 0x88, 0xc0, 0x02, 0x0b, 0x07, 0x81, 0x01, 0x0a, 0x06, 0x6d, 0x65, 0x6d, 0x6f, 0x72,
    0x79, 0x02, 0x00, 0x03, 0x73, 0x75, 0x6d, 0x00, 0x01, 0x03, 0x73, 0x75, 0x62, 0x00, 0x02, 0x03,
    0x6d, 0x75, 0x6c, 0x00, 0x03, 0x0b, 0x5f, 0x69, 0x6e, 0x69, 0x74, 0x69, 0x61, 0x6c, 0x69, 0x7a,
    0x65, 0x00, 0x00, 0x19, 0x5f, 0x5f, 0x69, 0x6e, 0x64, 0x69, 0x72, 0x65, 0x63, 0x74, 0x5f, 0x66,
    0x75, 0x6e, 0x63, 0x74, 0x69, 0x6f, 0x6e, 0x5f, 0x74, 0x61, 0x62, 0x6c, 0x65, 0x01, 0x00, 0x10,
    0x5f, 0x5f, 0x65, 0x72, 0x72, 0x6e, 0x6f, 0x5f, 0x6c, 0x6f, 0x63, 0x61, 0x74, 0x69, 0x6f, 0x6e,
    0x00, 0x07, 0x09, 0x73, 0x74, 0x61, 0x63, 0x6b, 0x53, 0x61, 0x76, 0x65, 0x00, 0x04, 0x0c, 0x73,
    0x74, 0x61, 0x63, 0x6b, 0x52, 0x65, 0x73, 0x74, 0x6f, 0x72, 0x65, 0x00, 0x05, 0x0a, 0x73, 0x74,
    0x61, 0x63, 0x6b, 0x41, 0x6c, 0x6c, 0x6f, 0x63, 0x00, 0x06, 0x09, 0x07, 0x01, 0x00, 0x41, 0x01,
    0x0b, 0x01, 0x00, 0x0a, 0x40, 0x08, 0x03, 0x00, 0x01, 0x0b, 0x07, 0x00, 0x20, 0x00, 0x20, 0x01,
    0x6a, 0x0b, 0x07, 0x00, 0x20, 0x00, 0x20, 0x01, 0x6b, 0x0b, 0x07, 0x00, 0x20, 0x00, 0x20, 0x01,
    0x6c, 0x0b, 0x04, 0x00, 0x23, 0x00, 0x0b, 0x06, 0x00, 0x20, 0x00, 0x24, 0x00, 0x0b, 0x10, 0x00,
    0x23, 0x00, 0x20, 0x00, 0x6b, 0x41, 0x70, 0x71, 0x22, 0x00, 0x24, 0x00, 0x20, 0x00, 0x0b, 0x05,
    0x00, 0x41, 0x80, 0x08, 0x0b
])
const wasmModule = new WebAssembly.Module(wasmCode);
const wasmInstance = new WebAssembly.Instance(wasmModule, {});

app.get('/', (request, response) => {
    response.sendFile('2.html', {root: __dirname});
});

app.get('/wasm', (request, response) => {
    response.sendFile('hello.wasm', {root: __dirname + '/../'});
});

app.get('/:name', (req, res) => {
    let func = req.params.name;

    if(wasmInstance.exports[func]){
        res.send(wasmInstance.exports[func](3,2).toString());
    }
    else{
        res.sendStatus(404);
    }
});

app.listen(3000, () => {
    console.log('Second task: http://localhost:3000');
});
